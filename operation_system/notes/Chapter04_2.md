# 第四章 第二节 磁盘

## 磁盘的结构

### 磁盘，磁道，扇区

磁盘的盘面被分为一个个的圈，就是磁道。一个磁道又被分为一个个的扇区。最内侧磁道的扇区面积最小，因此数据密度最大。

### 在磁盘中读取数据

把磁头移动到想要读写的扇区所在的磁道，磁盘旋转时，让目标扇区从此头下面划过，完成对磁盘扇区的读写工作。

### 磁盘的柱面，盘面

磁盘的物理地址：柱面号，盘面号，扇区号。

![磁盘的物理地址](https://github.com/nilshao/cpp-notebook/raw/master/operation_system/images/chapter4/磁盘的物理地址.jpeg)

### 磁盘的分类

活动头磁盘，固定头磁盘：这种磁盘中每个磁道都有对应的磁头

可换盘磁盘，固定盘磁盘

## 磁盘调度算法

![磁盘调度算法](https://github.com/nilshao/cpp-notebook/raw/master/operation_system/images/chapter4/磁盘调度算法.jpeg)

### 一次磁盘读写操作的时间：

1. 寻找时间（寻道时间）Ts：

    * 启动磁头臂，耗时为s

    * 移动磁头臂，每跨越一道磁道耗时为m，总共跨越n条磁道

    * Ts = s + m * n

2. 延迟时间Tr：

    通过旋转磁盘，使磁头定位到目标扇区所需要的时间。设磁盘转速为r，则平均所需的延迟时间为1/2r

3. 传输时间Tt：

    从磁盘读出或写入时间，假设磁盘转速weir，此次读写字节数为b，每个磁道上的字节数为N，则传输时间
    
    Tt=b/(r N)

Tr Tt是操作系统无法优化的，只和硬盘有关，因此只能优化磁盘调度算法

### FCFS

根据进程请求访问磁盘的先后顺序进行顺序。

### SSTF

贪心思想，会优先处理与当前磁头最近的磁道，保证每次寻道的时间最短，但是不能保证总的寻道时间最短。“眼前最优但是总体未必最优”，“饥饿现象”

### SCAN 扫描算法

SSTF产生饥饿的原因在于：随着进程不断进入，磁头可能只在同一个小区域内来回移动，为了防止这个现象，可以规定：只有磁头移动到最外侧磁道的时候才能往内移动，移动到最内侧的时候才能向外移动。也称为”电梯算法“

**LOOK调度：**
边移动边观察，不用每次都移到最外边或最内边才掉头

### C-SCAN 循环扫描算法

SCAN算法对于各个位置磁道的响应频率不均，C-SCAN只在磁头朝某一个方向移动时才访问磁道，返回时直接快速移动到起始端而不处理任何请求。

### 总结

![磁盘调度算法总结](https://github.com/nilshao/cpp-notebook/raw/master/operation_system/images/chapter4/磁盘调度算法总结.jpeg)

## 减少延迟时间的方法

延迟时间：把目标扇区赚到磁头下面所花费的时间。

磁头独取一个扇区的内容后，需要一段时间进行处理，如果数据存入连续的几个扇区，会造成很大的延迟时间。

### 交替编号

让逻辑上相邻的扇区在物理上有一定的间隔。

### 错位命名

### 磁盘地址结构的设计

### 总结

![减少延迟时间的方法](https://github.com/nilshao/cpp-notebook/raw/master/operation_system/images/chapter4/减少延迟时间的方法.jpeg)

## 磁盘的管理

磁盘的管理：磁盘初始化，引导块，坏块的管理

### 磁盘初始化

1. 低级格式化（物理格式化），将磁盘的各个磁道划分为扇区，一个扇区常分为头、数据区、尾三个部分。

2. 将磁盘分区，每个分区由若干柱面组成（c盘，d盘，e盘等）

3. 进行逻辑格式化，创建文件系统

### 引导块

自举程序：计算机开机时需要通过执行初始化程序（自举程序）完成。ROM中存放很小的自举程序。完整的自举程序放在磁盘的启动块（引导块/启动分区）上，启动块位于磁盘的固定位置。

### 坏块的管理

无法正常使用的扇区就是坏块，硬件故障，操作系统无法修复，因此需要标记出来。磁盘控制器会维护一个坏块链表，并管理备用扇区。

